<?xml version="1.0" encoding="UTF-8"?>
<!--

WARNiNG: Ansible managed file, manual changes to this file will be overwritten by ansible runs.
See the original backup of this file for a sample default configuration.

-->
<AttributeResolver
        xmlns="urn:mace:shibboleth:2.0:resolver"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
        xsi:schemaLocation="urn:mace:shibboleth:2.0:resolver http://shibboleth.net/schema/idp/shibboleth-attribute-resolver.xsd">

    <!-- ========================================== -->
    <!--      Attribute Definitions                 -->
    <!-- ========================================== -->

     <AttributeDefinition id="uid" xsi:type="Simple" sourceAttributeID="uid">
        <Dependency ref="myLDAP" />
        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:uid" encodeType="false" />
        <AttributeEncoder xsi:type="SAML2String" name="urn:oid:0.9.2342.19200300.100.1.1" friendlyName="uid" encodeType="false" />
    </AttributeDefinition>

    <AttributeDefinition id="mail" xsi:type="Simple" sourceAttributeID="mail">
        <Dependency ref="myLDAP" />
        <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:mail" encodeType="false" />
        <AttributeEncoder xsi:type="SAML2String" name="urn:oid:0.9.2342.19200300.100.1.3" friendlyName="mail" encodeType="false" />
    </AttributeDefinition>
    
    <!-- This breaks things. Not sure why yet. -->
  	<!-- <AttributeDefinition id="displayName" xsi:type="Simple" sourceAttributeID="displayName">
  	    <Dependency ref="myLDAP" />
  	    <AttributeEncoder xsi:type="SAML1String" name="urn:mace:dir:attribute-def:displayName" encodeType="false" />
  	    <AttributeEncoder xsi:type="SAML2String" name="urn:oid:2.16.840.1.113730.3.1.241" friendlyName="displayName" encodeType="false" />
  	<AttributeDefinition> -->
        
    <!-- ========================================== -->
    <!--      Data Connectors                       -->
    <!-- ========================================== -->
    
	<DataConnector id="myLDAP"
		xsi:type="LDAPDirectory"
	    ldapURL="%{idp.attribute.resolver.LDAP.ldapURL}"
	    baseDN="%{idp.attribute.resolver.LDAP.baseDN}"
	    principal="%{idp.attribute.resolver.LDAP.bindDN}"
	    principalCredential="%{idp.attribute.resolver.LDAP.bindDNCredential}">
	    <FilterTemplate>
	        <![CDATA[
	            %{idp.attribute.resolver.LDAP.searchFilter}
	        ]]>
	    </FilterTemplate>
	    <ReturnAttributes>%{idp.attribute.resolver.LDAP.returnAttributes}</ReturnAttributes>
  		<ConnectionPool
  	            minPoolSize="%{idp.pool.LDAP.minSize:0}"
  	            maxPoolSize="%{idp.pool.LDAP.maxSize:3}"
  	            blockWaitTime="%{idp.pool.LDAP.blockWaitTime:PT3S}"
  	            validatePeriodically="%{idp.pool.LDAP.validatePeriodically:true}"
  	            validateTimerPeriod="%{idp.pool.LDAP.validatePeriod:PT30M}"
  	            expirationTime="%{idp.pool.LDAP.idleTime:PT10M}"
  	            failFastInitialize="%{idp.pool.LDAP.failFastInitialize:true}" />
	</DataConnector>

</AttributeResolver>
