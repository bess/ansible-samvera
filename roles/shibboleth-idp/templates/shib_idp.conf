# !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
# THIS IS AN ANSIBLE-MANAGED FILE. ALL CHANGES WILL BE OVERRIDEN IF CONFIG
# MANAGER IS RUN. MAKE SURE YOU REFLECT CHANGES IN THE ANSIBLE SCRIPTS IF
# THEY SHOULD BE MADE PERMANENT.
# !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

ServerName {{ hostname }}.{{ domain }}

<VirtualHost *:80>
  DocumentRoot /var/www/html
  Redirect permanent / https://{{ hostname }}.{{ domain }}/
</VirtualHost>

<VirtualHost *:443>
  ServerName {{ [hostname, domain] | join('.') }}
  UseCanonicalName On
  ServerAdmin {{ server_admin_email }}
  CustomLog /var/log/apache2/{{ hostname }}.access.log combined
  ErrorLog /var/log/apache2/{{ hostname }}.error.log
  SSLEngine On
  SSLCipherSuite HIGH:MEDIUM:!aNULL:!kRSA:!MD5:!RC4
  SSLProtocol all -SSLv2 -SSLv3
  SSLCertificateKeyFile /etc/ssl/private/STAR_curationexperts_com.key
  SSLCertificateFile /etc/ssl/certs/STAR_curationexperts_com.crt
  SSLCertificateChainFile /etc/ssl/certs/STAR_curationexperts_com_bundle.pem

  <IfModule headers_module>
    Header set X-Frame-Options DENY
    Header set Strict-Transport-Security "max-age=31536000;includeSubDomains"
  </IfModule>

  ProxyPass /idp ajp://localhost:8009/idp retry=5
  <Proxy ajp://localhost:8009>
    Require all granted
  </Proxy>
</VirtualHost>
